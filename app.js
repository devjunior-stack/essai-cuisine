const USER_KEY = 'cf_user_pro';
const RECIPES_KEY = 'cf_recipes_pro';
const sampleRecipes = [{ id: 1, title: 'Tajine de poulet', img: 'images/image1.png', author: 'Chaima', ingredients: ['3 kg de poulet', '2 oignons'], steps: ['Préparer', 'Cuire', 'Servir'] }, { id: 2, title: 'Poulet Yassa', img: 'images/image2.png', author: 'Fatou', ingredients: ['Poulet', 'Oignons', 'Citron'], steps: ['Mariner', 'Cuire', 'Servir'] }, { id: 3, title: 'Riz Jollof', img: 'images/image3.png', author: 'Amina', ingredients: ['Riz', 'Tomates', 'Epices'], steps: ['Préparer sauce', 'Cuire riz'] }];
function saveRecipes(l) { localStorage.setItem(RECIPES_KEY, JSON.stringify(l)); } function loadRecipes() { return JSON.parse(localStorage.getItem(RECIPES_KEY) || 'null') || sampleRecipes.slice(); } function currentUser() { return JSON.parse(localStorage.getItem(USER_KEY) || 'null'); } function setUser(u) { localStorage.setItem(USER_KEY, JSON.stringify(u)); updateTopAuth(); } function logout() { localStorage.removeItem(USER_KEY); updateTopAuth(); location.href = 'inscription.html'; } function updateTopAuth() { const top = document.getElementById('topAuth'); if (!top) return; top.innerHTML = ''; const user = currentUser(); if (user) { const profil = document.createElement('a'); profil.href = 'profil.html'; profil.className = 'top-auth-btn'; profil.textContent = 'Mon profil'; const btn = document.createElement('button'); btn.className = 'top-auth-btn'; btn.textContent = 'Se déconnecter'; btn.addEventListener('click', logout); top.appendChild(profil); top.appendChild(btn); } else { const link = document.createElement('a'); link.href = 'inscription.html'; link.className = 'top-auth-btn'; link.textContent = 'S\'inscrire / Se connecter'; top.appendChild(link); } } function renderRecipesGrid() { const grid = document.getElementById('recipesGrid'); if (!grid) return; const list = loadRecipes(); grid.innerHTML = ''; list.forEach(r => { const card = document.createElement('div'); card.className = 'card'; card.innerHTML = `<img src="${r.img}" alt="${r.title}" style="width:100%;height:180px;object-fit:cover;border-radius:8px"><h3>${r.title}</h3><p class="meta">par ${r.author}</p><div class="recipe-meta"><a class="btn" href="detail.html?id=${r.id}">Voir plus</a></div>`; grid.appendChild(card); }); } function renderDetail() { const area = document.getElementById('detailArea'); if (!area) return; const params = new URLSearchParams(location.search); const id = parseInt(params.get('id') || '0'); const list = loadRecipes(); const r = list.find(x => x.id === id); if (!r) { area.innerHTML = '<p>Recette introuvable.</p>'; return; } area.innerHTML = `<div class="card"><h2>${r.title}</h2><img src="${r.img}" style="width:100%;height:360px;object-fit:cover;border-radius:8px;margin-bottom:10px"><p class="meta">par ${r.author}</p><h4>Ingrédients</h4><ul>${r.ingredients.map(i => '<li>' + i + '</li>').join('')}</ul><h4>Étapes</h4><ol>${r.steps.map(s => '<li>' + s + '</li>').join('')}</ol></div>`; } function handleSignup() { const form = document.getElementById('signupForm'); if (!form) return; form.addEventListener('submit', e => { e.preventDefault(); const name = document.getElementById('name').value.trim(); const email = document.getElementById('email').value.trim(); const pwd = document.getElementById('password').value; if (pwd.length < 8) { alert('Le mot de passe doit contenir au moins 8 caractères.'); return; } setUser({ name, email, logged: true }); alert('Compte créé. Bienvenue ' + name + '!'); location.href = 'index.html'; }); } function handlePublish() { const form = document.getElementById('publishForm'); if (!form) return; const fileInput = document.getElementById('pImageFile'); const preview = document.getElementById('imgPreview'); if (fileInput) { fileInput.addEventListener('change', () => { const f = fileInput.files[0]; if (!f) return; const reader = new FileReader(); reader.onload = () => preview.innerHTML = '<img src="' + reader.result + '" style="max-width:100%;height:auto">'; reader.readAsDataURL(f); }); } form.addEventListener('submit', e => { e.preventDefault(); const user = currentUser(); if (!user) { alert('Veuillez vous connecter.'); location.href = 'inscription.html'; return; } const title = document.getElementById('pTitle').value.trim(); const author = document.getElementById('pAuthor').value.trim() || user.name; const ingredients = document.getElementById('pIngredients').value.split('\\n').map(s => s.trim()).filter(Boolean); const steps = document.getElementById('pSteps').value.split('\\n').map(s => s.trim()).filter(Boolean); const file = document.getElementById('pImageFile').files[0]; const list = loadRecipes(); const id = (list.reduce((m, x) => Math.max(m, x.id), 0) || 0) + 1; if (file) { const reader = new FileReader(); reader.onload = () => { list.unshift({ id, title, img: reader.result, author, ingredients, steps }); saveRecipes(list); alert('Recette publiée !'); location.href = 'recettes.html' }; reader.readAsDataURL(file); } else { const defaultImg = 'images/image1.png'; list.unshift({ id, title, img: defaultImg, author, ingredients, steps }); saveRecipes(list); alert('Recette publiée !'); location.href = 'recettes.html'; } }); } function protectPages() { const restricted = ['recettes.html', 'publier.html', 'profil.html', 'detail.html']; const current = location.pathname.split('/').pop(); if (restricted.includes(current) && !currentUser()) { alert('Veuillez vous inscrire / vous connecter pour accéder à cette page.'); location.href = 'inscription.html'; } } function renderProfile() { const nameEl = document.getElementById('userName'); const user = currentUser(); if (nameEl && user) nameEl.textContent = user.name; const grid = document.getElementById('userRecipes'); if (!grid) return; const list = loadRecipes(); grid.innerHTML = ''; list.filter(r => r.author === (user ? user.name : '')).forEach(r => { const d = document.createElement('div'); d.className = 'card'; d.innerHTML = `<img src="${r.img}" alt="${r.title}" style="width:100%;height:140px;object-fit:cover;border-radius:8px"><h3>${r.title}</h3>`; grid.appendChild(d); }); } function handleSearch() { const btn = document.getElementById('searchBtn'); if (!btn) return; btn.addEventListener('click', () => { const q = document.getElementById('searchInput').value.trim().toLowerCase(); const grid = document.getElementById('recipesGrid'); if (!grid) return; const list = loadRecipes().filter(r => r.title.toLowerCase().includes(q) || r.author.toLowerCase().includes(q)); grid.innerHTML = ''; list.forEach(r => { const card = document.createElement('div'); card.className = 'card'; card.innerHTML = `<img src="${r.img}" alt="${r.title}" style="width:100%;height:180px;object-fit:cover;border-radius:8px"><h3>${r.title}</h3><p class="meta">par ${r.author}</p><div class="recipe-meta"><a class="btn" href="detail.html?id=${r.id}">Voir plus</a></div>`; grid.appendChild(card); }); }); } document.addEventListener('DOMContentLoaded', () => { updateTopAuth(); protectPages(); renderRecipesGrid(); renderDetail(); handlePublish(); handleSignup(); renderProfile(); handleSearch(); });



// simplified admin logic
// const RECIPES_KEY = 'cf_recipes_pro';
function loadRecipes() { return JSON.parse(localStorage.getItem(RECIPES_KEY) || '[]'); }
function saveRecipes(l) { localStorage.setItem(RECIPES_KEY, JSON.stringify(l)); }
function loadAdminList() {
    const c = document.getElementById('recipesList'); c.innerHTML = '';
    loadRecipes().forEach((r, i) => {
        c.innerHTML += `<div class='card'><strong>${r.title}</strong><button onclick='del(${i})'>X</button></div>`
    });
}
function del(i) { let l = loadRecipes(); l.splice(i, 1); saveRecipes(l); loadAdminList(); }
document.getElementById('addForm').onsubmit = e => {
    e.preventDefault(); let l = loadRecipes();
    l.unshift({ id: Date.now(), title: title.value, img: image.value, author: 'Admin', ingredients: ['ok'], steps: content.value.split('\n') });
    saveRecipes(l); loadAdminList();
};
loadAdminList();




